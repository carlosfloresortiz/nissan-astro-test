---
import MainLayout from "../layouts/MainLayout.astro";

import HeroCarousel from "../components/HeroCarousel.astro";

import { getCarousels } from "../lib/strapi";
import type { Carousel as CarouselType } from "../lib/strapi"; // ---Importaci√≥n Tipo

let carousels: CarouselType[] = []; // ---Asignacion Tipo
let error = null;
try {
  carousels = await getCarousels();
} catch (e) {
  error = e instanceof Error ? e.message : "Failed to fetch carousels";
  console.error("Error fetching carousels:", e);
}
---

<MainLayout title="Nissan Astro - Test">
  {
    error && (
      <div class="error-message">
        <strong>Error loading carousels:</strong> {error}
        <br />
        <small>
          Make sure your Strapi server is running and the API token is
          configured correctly.
        </small>
      </div>
    )
  }

  {
    !error && carousels.length === 0 && (
      <div class="empty-message">
        <h2>No carousels found</h2>
        <p>
          Create some carousels in your Strapi admin panel to see them here.
        </p>
      </div>
    )
  }

  {
    !error &&
      carousels.length > 0 &&
      carousels.every((c) => {
        // Check for Items field directly on carousel or in attributes
        const items = c.Items || [];
        return !items || items.length === 0;
      }) && (
        <div class="empty-message">
          <h2>Carousels found but no items</h2>
          <p>Your carousels exist but don't have any items yet.</p>
          <p>Add items to your carousels in the Strapi Content Manager.</p>
        </div>
      )
  }

  {
    !error && carousels.length > 0 && (
      <HeroCarousel heroCarouselData={carousels[0]} />
    )
  }
</MainLayout>
